{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>
        <i class="fas fa-tree me-2"></i>{{ zone.name }}
    </h2>
    <div>
        <a href="{{ url_for('map_view') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i>–ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ
        </a>
        {% if session.role in ['admin', 'creator'] %}
        <button type="button" class="btn btn-danger ms-2" data-bs-toggle="modal" data-bs-target="#deleteZoneModal">
            <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É
        </button>
        {% endif %}
    </div>
</div>

<div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–æ–Ω–µ -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–µ–ª–µ–Ω–æ–π –∑–æ–Ω–µ
                </h5>
            </div>
            <div class="card-body">
                <table class="table">
                    <tr>
                        <th><i class="fas fa-tag me-2"></i>–¢–∏–ø –∑–æ–Ω—ã:</th>
                        <td>{{ zone.zone_type }}</td>
                    </tr>
                    <tr>
                        <th><i class="fas fa-ruler-combined me-2"></i>–ü–ª–æ—â–∞–¥—å:</th>
                        <td>{{ zone.area }} –≥–∞</td>
                    </tr>
                    <tr>
                        <th><i class="fas fa-map-marker-alt me-2"></i>–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:</th>
                        <td>{{ zone.location }}</td>
                    </tr>
                    <tr>
                        <th><i class="fas fa-city me-2"></i>–ì–æ—Ä–æ–¥:</th>
                        <td>{{ zone.city_name }}</td>
                    </tr>
                    <tr>
                        <th><i class="fas fa-calendar me-2"></i>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</th>
                        <td>{{ zone.created_date[:10] }}</td>
                    </tr>
                    {% if zone.coordinates %}
                    <tr>
                        <th><i class="fas fa-map-pin me-2"></i>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</th>
                        <td><small class="text-muted">{{ zone.coordinates }}</small></td>
                    </tr>
                    {% endif %}
                </table>
            </div>
        </div>

        <!-- –ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
        <div class="card mt-4">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-building me-2"></i>–ü—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
                </h5>
                {% if session.role in ['admin', 'creator'] %}
                <button type="button" class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#addOrganizationModal">
                    <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å
                </button>
                {% endif %}
            </div>
            <div class="card-body">
                {% if zone_organizations %}
                    {% for org in zone_organizations %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="card-title mb-1">
                                        {% if org.org_type == 'non-profit' %}
                                            <i class="fas fa-hands-helping me-1 text-success"></i>
                                        {% elif org.org_type == 'commercial' %}
                                            <i class="fas fa-building me-1 text-primary"></i>
                                        {% elif org.org_type == 'educational' %}
                                            <i class="fas fa-graduation-cap me-1 text-info"></i>
                                        {% elif org.org_type == 'volunteer' %}
                                            <i class="fas fa-users me-1 text-warning"></i>
                                        {% elif org.org_type == 'governmental' %}
                                            <i class="fas fa-landmark me-1 text-danger"></i>
                                        {% else %}
                                            <i class="fas fa-briefcase me-1 text-secondary"></i>
                                        {% endif %}
                                        {{ org.organization_name }}
                                    </h6>
                                    <p class="card-text small mb-1">
                                        <strong>–¢–∏–ø –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:</strong>
                                        <span class="badge bg-{{ 'success' if org.responsibility_type == 'maintenance' else 'primary' if org.responsibility_type == 'sponsorship' else 'warning' if org.responsibility_type == 'partnership' else 'info' }}">
                                            {% if org.responsibility_type == 'maintenance' %}–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
                                            {% elif org.responsibility_type == 'sponsorship' %}–°–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ
                                            {% elif org.responsibility_type == 'partnership' %}–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ
                                            {% elif org.responsibility_type == 'volunteer' %}–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ
                                            {% else %}{{ org.responsibility_type }}{% endif %}
                                        </span>
                                    </p>
                                    {% if org.notes %}
                                    <p class="card-text small text-muted mb-1">
                                        <i class="fas fa-sticky-note me-1"></i>{{ org.notes }}
                                    </p>
                                    {% endif %}
                                    {% if org.contact_person %}
                                    <p class="card-text small mb-1">
                                        <i class="fas fa-user me-1"></i>{{ org.contact_person }}
                                    </p>
                                    {% endif %}
                                    {% if org.phone or org.email %}
                                    <p class="card-text small mb-1">
                                        {% if org.phone %}
                                        <i class="fas fa-phone me-1"></i>{{ org.phone }}
                                        {% endif %}
                                        {% if org.email %}
                                        <i class="fas fa-envelope ms-2 me-1"></i>{{ org.email }}
                                        {% endif %}
                                    </p>
                                    {% endif %}
                                    <small class="text-muted">
                                        <i class="fas fa-calendar me-1"></i>–ü—Ä–∏–≤—è–∑–∞–Ω–æ: {{ org.start_date[:10] }}
                                    </small>
                                </div>
                                {% if session.role in ['admin', 'creator'] %}
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <form method="POST" action="{{ url_for('remove_organization_from_zone', zone_id=zone.id, organization_id=org.organization_id) }}"
                                                  onsubmit="return confirm('–û—Ç–≤—è–∑–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –æ—Ç –∑–æ–Ω—ã?')">
                                                <button type="submit" class="dropdown-item text-danger">
                                                    <i class="fas fa-unlink me-1"></i>–û—Ç–≤—è–∑–∞—Ç—å
                                                </button>
                                            </form>
                                        </li>
                                    </ul>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted text-center py-3">
                        <i class="fas fa-building fa-2x text-muted mb-2"></i><br>
                        –ù–µ—Ç –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
                    </p>
                    {% if session.role in ['admin', 'creator'] %}
                    <div class="text-center">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addOrganizationModal">
                            <i class="fas fa-plus me-1"></i>–ü—Ä–∏–≤—è–∑–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
                        </button>
                    </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>

    <!-- –§–æ—Ä–º—ã –∏ –∑–∞–¥–∞—á–∏ -->
    <div class="col-md-8">
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                    <i class="fas fa-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('add_task') }}">
                    <input type="hidden" name="zone_id" value="{{ zone.id }}">

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–¢–∏–ø –∑–∞–¥–∞—á–∏:</label>
                                <select name="task_type" class="form-select" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–∞–¥–∞—á–∏...</option>
                                    <option value="watering">üíß –ü–æ–ª–∏–≤</option>
                                    <option value="pruning">‚úÇÔ∏è –û–±—Ä–µ–∑–∫–∞</option>
                                    <option value="cleaning">üßπ –£–±–æ—Ä–∫–∞</option>
                                    <option value="repair">üîß –†–µ–º–æ–Ω—Ç</option>
                                    <option value="planting">üå± –ü–æ—Å–∞–¥–∫–∞</option>
                                    <option value="fertilizing">üåø –£–¥–æ–±—Ä–µ–Ω–∏–µ</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</label>
                                <select name="priority" class="form-select" required>
                                    <option value="low">üü¢ –ù–∏–∑–∫–∏–π</option>
                                    <option value="medium" selected>üü° –°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="high">üî¥ –í—ã—Å–æ–∫–∏–π</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label>
                        <textarea name="description" class="form-control" rows="2"
                                  placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –ø–æ–¥—Ä–æ–±–Ω–æ..." required></textarea>
                    </div>

                    {% if session.role in ['admin', 'creator'] and organizations_for_assignment %}
                    <div class="mb-3">
                        <label class="form-label">–ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <select name="assigned_organization" class="form-select">
                            <option value="">-- –ë–µ–∑ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ --</option>
                            {% for org in organizations_for_assignment %}
                            <option value="{{ org.id }}">{{ org.name }} ({{ org.org_type }})</option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">–ï—Å–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏</small>
                    </div>
                    {% endif %}

                    <button type="submit" class="btn btn-success w-100">
                        <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                    </button>
                </form>
            </div>
        </div>

        <!-- –ó–∞–¥–∞—á–∏ –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é -->
        <div class="card mt-4">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-tasks me-2"></i>–ó–∞–¥–∞—á–∏ –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é
                </h5>
                <span class="badge bg-primary">{{ tasks|length }}</span>
            </div>
            <div class="card-body">
                {% if tasks %}
                    {% for task in tasks %}
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <div class="flex-grow-1">
                                    <h6 class="card-title mb-1">
                                        {% if task.task_type == 'watering' %}
                                            <i class="fas fa-tint me-1 text-primary"></i>
                                        {% elif task.task_type == 'pruning' %}
                                            <i class="fas fa-cut me-1 text-success"></i>
                                        {% elif task.task_type == 'cleaning' %}
                                            <i class="fas fa-broom me-1 text-info"></i>
                                        {% elif task.task_type == 'repair' %}
                                            <i class="fas fa-tools me-1 text-danger"></i>
                                        {% elif task.task_type == 'planting' %}
                                            <i class="fas fa-seedling me-1 text-success"></i>
                                        {% elif task.task_type == 'fertilizing' %}
                                            <i class="fas fa-leaf me-1 text-warning"></i>
                                        {% else %}
                                            <i class="fas fa-tasks me-1 text-secondary"></i>
                                        {% endif %}
                                        {{ task.description }}
                                    </h6>
                                    <p class="card-text mb-1 small text-muted">
                                        –°–æ–∑–¥–∞–ª: {{ task.creator_name }} |
                                        {{ task.created_date[:10] }}
                                    </p>
                                    <div class="mt-2">
                                        <span class="badge bg-{{ 'danger' if task.priority == 'high' else 'warning' if task.priority == 'medium' else 'secondary' }} me-2">
                                            {% if task.priority == 'high' %}üî¥ –í—ã—Å–æ–∫–∏–π
                                            {% elif task.priority == 'medium' %}üü° –°—Ä–µ–¥–Ω–∏–π
                                            {% else %}üü¢ –ù–∏–∑–∫–∏–π{% endif %}
                                        </span>
                                        <span class="badge bg-{{ 'success' if task.status == 'completed' else 'info' if task.status == 'in_progress' else 'warning' if task.status == 'verification_requested' else 'secondary' }}">
                                            {% if task.status == 'pending' %}‚è≥ –û–∂–∏–¥–∞–µ—Ç
                                            {% elif task.status == 'in_progress' %}üîÑ –í —Ä–∞–±–æ—Ç–µ
                                            {% elif task.status == 'verification_requested' %}üìù –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
                                            {% elif task.status == 'completed' %}‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∞
                                            {% else %}{{ task.status }}{% endif %}
                                        </span>
                                        {% if task.assigned_organization_name %}
                                        <span class="badge bg-info ms-2">
                                            <i class="fas fa-building me-1"></i>{{ task.assigned_organization_name }}
                                        </span>
                                        {% endif %}
                                    </div>
                                    {% if task.status == 'verification_requested' %}
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <i class="fas fa-user-check me-1"></i>
                                            –ó–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç: {{ task.verification_requested_by_name }}
                                        </small>
                                    </div>
                                    {% endif %}
                                    {% if task.status == 'completed' and task.completed_by_name %}
                                    <div class="mt-2">
                                        <small class="text-muted">
                                            <i class="fas fa-check-circle me-1"></i>
                                            –í—ã–ø–æ–ª–Ω–µ–Ω–∞: {{ task.completed_by_name }}
                                        </small>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="btn-group btn-group-sm mt-2">
                                {% if task.status == 'pending' or task.status == 'in_progress' %}
                                    {% if session.role in ['admin', 'creator'] %}
                                    <a href="{{ url_for('update_task_status', task_id=task.id, status='in_progress') }}"
                                       class="btn btn-outline-info btn-sm">
                                        <i class="fas fa-play me-1"></i>–í —Ä–∞–±–æ—Ç—É
                                    </a>
                                    {% endif %}
                                    <a href="{{ url_for('update_task_status', task_id=task.id, status='verification_requested') }}"
                                       class="btn btn-outline-success btn-sm"
                                       onclick="return confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏?')">
                                        <i class="fas fa-check me-1"></i>–í—ã–ø–æ–ª–Ω–µ–Ω–æ
                                    </a>
                                {% endif %}

                                {% if task.status == 'in_progress' and session.role in ['admin', 'creator'] %}
                                <a href="{{ url_for('update_task_status', task_id=task.id, status='pending') }}"
                                   class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-pause me-1"></i>–í –æ–∂–∏–¥–∞–Ω–∏–µ
                                </a>
                                {% endif %}

                                {% if task.status == 'verification_requested' and session.role in ['admin', 'creator'] %}
                                <a href="{{ url_for('update_task_status', task_id=task.id, status='completed') }}"
                                   class="btn btn-outline-success btn-sm"
                                   onclick="return confirm('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏?')">
                                    <i class="fas fa-check-double me-1"></i>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
                                </a>
                                <a href="{{ url_for('update_task_status', task_id=task.id, status='in_progress') }}"
                                   class="btn btn-outline-warning btn-sm"
                                   onclick="return confirm('–í–µ—Ä–Ω—É—Ç—å –∑–∞–¥–∞—á—É –≤ —Ä–∞–±–æ—Ç—É?')">
                                    <i class="fas fa-undo me-1"></i>–í–µ—Ä–Ω—É—Ç—å
                                </a>
                                {% endif %}

                                {% if session.role in ['admin', 'creator'] %}
                                <form method="POST" action="{{ url_for('delete_task', task_id=task.id) }}"
                                      class="d-inline"
                                      onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')">
                                    <button type="submit" class="btn btn-outline-danger btn-sm">
                                        <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted text-center py-3">
                        <i class="fas fa-check-circle fa-2x text-success mb-2"></i><br>
                        –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- –§–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞ –∏ –∏—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤ -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-clipboard-check me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
                        </h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('add_report') }}">
                            <input type="hidden" name="zone_id" value="{{ zone.id }}">

                            <div class="mb-3">
                                <label class="form-label">–û—Ü–µ–Ω–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (0-100%):</label>
                                <input type="number" name="health_score" class="form-control" min="0" max="100" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">–¢—Ä–µ–±—É—é—Ç—Å—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è:</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="needs_watering" id="watering">
                                    <label class="form-check-label" for="watering">
                                        <i class="fas fa-tint me-1"></i>–ü–æ–ª–∏–≤
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="needs_pruning" id="pruning">
                                    <label class="form-check-label" for="pruning">
                                        <i class="fas fa-cut me-1"></i>–û–±—Ä–µ–∑–∫–∞
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="needs_cleaning" id="cleaning">
                                    <label class="form-check-label" for="cleaning">
                                        <i class="fas fa-broom me-1"></i>–£–±–æ—Ä–∫–∞
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="needs_repair" id="repair">
                                    <label class="form-check-label" for="repair">
                                        <i class="fas fa-tools me-1"></i>–†–µ–º–æ–Ω—Ç
                                    </label>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">–ó–∞–º–µ—Ç–∫–∏:</label>
                                <textarea name="notes" class="form-control" rows="3" placeholder="–û–ø–∏—à–∏—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–æ–Ω—ã..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-success w-100">
                                <i class="fas fa-paper-plane me-1"></i>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>–ò—Å—Ç–æ—Ä–∏—è –æ—Ç—á–µ—Ç–æ–≤
                        </h5>
                    </div>
                    <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                        {% if reports %}
                            {% for report in reports %}
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div>
                                            <h6 class="card-title">
                                                –û—Ü–µ–Ω–∫–∞:
                                                <span class="badge bg-{{ 'success' if report.health_score >= 80 else 'warning' if report.health_score >= 60 else 'danger' }}">
                                                    {{ report.health_score }}%
                                                </span>
                                            </h6>
                                            {% if report.notes %}
                                            <p class="card-text">{{ report.notes }}</p>
                                            {% endif %}
                                            <small class="text-muted">
                                                <i class="fas fa-user me-1"></i>{{ report.reporter_name }}
                                            </small>
                                        </div>
                                        <small class="text-muted text-end">
                                            <i class="fas fa-calendar me-1"></i>{{ report.report_date[:10] }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted text-center py-3">
                                <i class="fas fa-clipboard-list fa-2x text-muted mb-2"></i><br>
                                –ù–µ—Ç –æ—Ç—á–µ—Ç–æ–≤
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="card mt-4">
    <div class="card-header bg-light">
        <h5 class="mb-0">
            <i class="fas fa-bolt me-2"></i>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        </h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-3 text-center">
                <a href="{{ url_for('map_view') }}" class="btn btn-outline-primary w-100 mb-2">
                    <i class="fas fa-map me-1"></i>–ù–∞ –∫–∞—Ä—Ç—É
                </a>
            </div>
            <div class="col-md-3 text-center">
                <a href="{{ url_for('add_zone') }}" class="btn btn-outline-success w-100 mb-2">
                    <i class="fas fa-plus me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É
                </a>
            </div>
            <div class="col-md-3 text-center">
                <a href="{{ url_for('reports') }}" class="btn btn-outline-info w-100 mb-2">
                    <i class="fas fa-chart-bar me-1"></i>–í—Å–µ –æ—Ç—á–µ—Ç—ã
                </a>
            </div>
            {% if session.role in ['admin', 'creator'] and has_tasks_awaiting_verification() %}
            <div class="col-md-3 text-center">
                <a href="{{ url_for('task_verification') }}" class="btn btn-outline-warning w-100 mb-2">
                    <i class="fas fa-check-double me-1"></i>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á
                    <span class="badge bg-danger ms-1">{{ get_tasks_awaiting_verification_count() }}</span>
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∏–≤—è–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
{% if session.role in ['admin', 'creator'] %}
<div class="modal fade" id="addOrganizationModal" tabindex="-1" aria-labelledby="addOrganizationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="addOrganizationModalLabel">
                    <i class="fas fa-link me-2"></i>–ü—Ä–∏–≤—è–∑–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –∫ –∑–æ–Ω–µ
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('add_organization_to_zone', zone_id=zone.id) }}">
                    <div class="mb-3">
                        <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é:</label>
                        <select name="organization_id" class="form-select" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é --</option>
                            {% for org in available_organizations %}
                            <option value="{{ org.id }}">{{ org.name }} ({{ org.city_name }}, {{ org.org_type }})</option>
                            {% endfor %}
                        </select>
                        <small class="form-text text-muted">
                            –ï—Å–ª–∏ –Ω—É–∂–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, <a href="#" data-bs-toggle="modal" data-bs-target="#createOrganizationModal">—Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é</a>
                        </small>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–¢–∏–ø –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:</label>
                        <select name="responsibility_type" class="form-select" required>
                            <option value="maintenance">–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ)</option>
                            <option value="sponsorship">–°–ø–æ–Ω—Å–æ—Ä—Å—Ç–≤–æ (—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞)</option>
                            <option value="partnership">–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ (—Å–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞)</option>
                            <option value="volunteer">–í–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ (–¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å)</option>
                            <option value="monitoring">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å)</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <textarea name="notes" class="form-control" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–≤—è–∑–∫–µ..."></textarea>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong> –ü–æ—Å–ª–µ –ø—Ä–∏–≤—è–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ—è–≤–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –∑–æ–Ω—É.
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-link me-1"></i>–ü—Ä–∏–≤—è–∑–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ -->
<div class="modal fade" id="createOrganizationModal" tabindex="-1" aria-labelledby="createOrganizationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title" id="createOrganizationModalLabel">
                    <i class="fas fa-plus-circle me-2"></i>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('create_organization') }}">
                    <input type="hidden" name="zone_id" value="{{ zone.id }}">

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</label>
                                <input type="text" name="name" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–¢–∏–ø –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</label>
                                <select name="org_type" class="form-select" required>
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø --</option>
                                    <option value="non-profit">–ù–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</option>
                                    <option value="commercial">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</option>
                                    <option value="governmental">–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</option>
                                    <option value="educational">–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                                    <option value="volunteer">–í–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</option>
                                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</label>
                        <textarea name="description" class="form-control" rows="2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ:</label>
                                <input type="text" name="contact_person" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                                <input type="text" name="phone" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Email:</label>
                                <input type="email" name="email" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">–í–µ–±-—Å–∞–π—Ç:</label>
                                <input type="url" name="website" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">–ì–æ—Ä–æ–¥ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏:</label>
                        <select name="city_id" class="form-select" required>
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ --</option>
                            {% for city in cities %}
                            <option value="{{ city.id }}" {% if city.id == zone.city_id %}selected{% endif %}>{{ city.name }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–∏–≤—è–∑–∞—Ç—å –µ—ë –∫ —Ç–µ–∫—É—â–µ–π –∑–µ–ª–µ–Ω–æ–π –∑–æ–Ω–µ.
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-1"></i>–°–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∑–æ–Ω—ã -->
{% if session.role in ['admin', 'creator'] %}
<div class="modal fade" id="deleteZoneModal" tabindex="-1" aria-labelledby="deleteZoneModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteZoneModalLabel">
                    <i class="fas fa-exclamation-triangle me-2"></i>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>–í–Ω–∏–º–∞–Ω–∏–µ!</strong> –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
                </div>
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–µ–ª–µ–Ω—É—é –∑–æ–Ω—É <strong>"{{ zone.name }}"</strong>?</p>
                <p class="text-muted small">
                    –ë—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
                    <ul class="small">
                        <li>–û—Ç—á–µ—Ç—ã –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–æ–Ω—ã</li>
                        <li>–ó–∞–¥–∞—á–∏ –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é</li>
                        <li>–ü—Ä–∏–≤—è–∑–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</li>
                        <li>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</li>
                    </ul>
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>–û—Ç–º–µ–Ω–∞
                </button>
                <form method="POST" action="{{ url_for('delete_zone', zone_id=zone.id) }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å –∑–æ–Ω—É
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('organization_created') === 'true') {
        const createOrgModal = document.getElementById('createOrganizationModal');
        if (createOrgModal) {
            const modal = bootstrap.Modal.getInstance(createOrgModal);
            modal.hide();

            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success alert-dismissible fade show mt-3';
            successAlert.innerHTML = `
                <i class="fas fa-check-circle me-2"></i>
                –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–∏–≤—è–∑–∞—Ç—å –µ—ë –∫ –∑–æ–Ω–µ.
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.container.mt-4').insertBefore(successAlert, document.querySelector('.container.mt-4').firstChild);
        }
    }
});
</script>
{% endblock %}