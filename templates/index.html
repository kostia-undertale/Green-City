{% extends "base.html" %}

{% block content %}
{% if user_city %}
<div class="alert alert-info">
    <strong>üèôÔ∏è –¢–µ–∫—É—â–∏–π –≥–æ—Ä–æ–¥:</strong> {{ user_city }}
</div>

<div class="row">
    <div class="col-md-3">
        <div class="card text-white bg-primary mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ stats.total_zones }}</h5>
                <p class="card-text">–ó–µ–ª–µ–Ω—ã—Ö –∑–æ–Ω</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-warning mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ stats.pending_tasks }}</h5>
                <p class="card-text">–û–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–¥–∞—á</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-danger mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ stats.critical_tasks }}</h5>
                <p class="card-text">–°—Ä–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ "%.1f"|format(stats.avg_health) }}%</h5>
                <p class="card-text">–°—Ä–µ–¥–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</p>
            </div>
        </div>
    </div>
</div>

{% if stats.total_organizations > 0 %}
<div class="row mb-4">
    <div class="col-md-4 offset-md-4">
        <div class="card text-white bg-info">
            <div class="card-body text-center">
                <h5 class="card-title">{{ stats.total_organizations }}</h5>
                <p class="card-text">–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –≤ –≥–æ—Ä–æ–¥–µ</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é –≤ {{ user_city }}</h5>
            </div>
            <div class="card-body">
                {% if recent_tasks %}
                <div class="list-group">
                    {% for task in recent_tasks %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">{{ task.zone_name }} - {{ task.description }}</h6>
                            <span class="badge bg-{{ 'danger' if task.priority == 'high' else 'warning' if task.priority == 'medium' else 'secondary' }}">
                                {% if task.task_type == 'watering' %}–ü–æ–ª–∏–≤
                                {% elif task.task_type == 'pruning' %}–û–±—Ä–µ–∑–∫–∞
                                {% elif task.task_type == 'cleaning' %}–£–±–æ—Ä–∫–∞
                                {% elif task.task_type == 'repair' %}–†–µ–º–æ–Ω—Ç
                                {% else %}{{ task.task_type }}{% endif %}
                            </span>
                        </div>
                        <small class="text-muted">–°—Ç–∞—Ç—É—Å:
                            <span class="badge bg-{{ 'success' if task.status == 'completed' else 'warning' if task.status == 'in_progress' else 'secondary' }}">
                                {% if task.status == 'pending' %}–û–∂–∏–¥–∞–µ—Ç
                                {% elif task.status == 'in_progress' %}–í —Ä–∞–±–æ—Ç–µ
                                {% elif task.status == 'completed' %}–ó–∞–≤–µ—Ä—à–µ–Ω–∞
                                {% else %}{{ task.status }}{% endif %}
                            </span>
                        </small>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h5>
            </div>
            <div class="card-body">
                <a href="{{ url_for('map_view') }}" class="btn btn-outline-success w-100 mb-2">üó∫Ô∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞—Ä—Ç—É</a>
                <a href="{{ url_for('add_zone') }}" class="btn btn-outline-primary w-100 mb-2">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–æ–Ω—É</a>
                <a href="{{ url_for('reports') }}" class="btn btn-outline-info w-100">üìä –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</a>
                {% if session.role in ['admin', 'creator'] %}
                <a href="{{ url_for('admin_organizations') }}" class="btn btn-outline-secondary w-100 mt-2">üè¢ –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- –ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
<div class="jumbotron bg-light p-5 rounded">
    <h1 class="display-4">üåø –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ó–µ–ª–µ–Ω—ã–µ –≥–æ—Ä–æ–¥–∞!</h1>
    <p class="lead">–¶–∏—Ñ—Ä–æ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–µ–ª–µ–Ω—ã–º–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è–º–∏ –≥–æ—Ä–æ–¥–æ–≤ –†–æ—Å—Å–∏–∏</p>
    <hr class="my-4">
    <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä–∞–∂–¥–∞–Ω –∏ –ø–æ–º–æ–≥–∞–π—Ç–µ —É–ª—É—á—à–∞—Ç—å —ç–∫–æ–ª–æ–≥–∏—é –≤–∞—à–µ–≥–æ –≥–æ—Ä–æ–¥–∞!</p>

    <div class="row mt-5">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–î–ª—è –∂–∏—Ç–µ–ª–µ–π</h5>
                    <p class="card-text">–°–æ–æ–±—â–∞–π—Ç–µ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–µ–ª–µ–Ω—ã—Ö –∑–æ–Ω, —É—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö, –ø–æ–º–æ–≥–∞–π—Ç–µ —É–ª—É—á—à–∞—Ç—å –≤–∞—à –≥–æ—Ä–æ–¥</p>
                    <a href="{{ url_for('register') }}" class="btn btn-success">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</h5>
                    <p class="card-text">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∑–µ–ª–µ–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏ –≤–∞—à–µ–≥–æ –≥–æ—Ä–æ–¥–∞</p>
                    <a href="{{ url_for('login') }}" class="btn btn-outline-primary">–í–æ–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h5>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –≥–æ—Ä–æ–¥–∞:</h5>
        <div class="row">
            <div class="col-md-4">
                <ul class="list-unstyled">
                    <li>üèôÔ∏è –ë–∞—Ä–Ω–∞—É–ª</li>
                    <li>üèôÔ∏è –ë–∏–π—Å–∫</li>
                    <li>üèôÔ∏è –†—É–±—Ü–æ–≤—Å–∫</li>
                    <li>üèôÔ∏è –ö–æ—Ç–µ–ª—å–Ω–∏–∫–æ–≤–æ</li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul class="list-unstyled">
                    <li>üèôÔ∏è –ö–µ–º–µ—Ä–æ–≤–æ</li>
                    <li>üèôÔ∏è –ü—Ä–æ–∫–æ–ø—å–µ–≤—Å–∫</li>
                    <li>üèôÔ∏è –ê–±–∞–∫–∞–Ω</li>
                    <li>üèôÔ∏è –ß–µ—Ä–Ω–æ–≥–æ—Ä—Å–∫</li>
                </ul>
            </div>
            <div class="col-md-4">
                <ul class="list-unstyled">
                    <li>üèôÔ∏è –ö–æ–≤–¥–æ—Ä</li>
                    <li>üèôÔ∏è –ö–∏–Ω–≥–∏—Å–µ–ø–ø</li>
                    <li>üèôÔ∏è –ë–µ—Ä–µ–∑–Ω–∏–∫–∏</li>
                    <li>üèôÔ∏è –ò –¥—Ä—É–≥–∏–µ...</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}